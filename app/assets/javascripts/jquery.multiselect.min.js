(function(a,b){var c=0;a.widget("ech.multiselect",{options:{header:true,height:175,minWidth:225,classes:"",checkAllText:"Check all",uncheckAllText:"Uncheck all",noneSelectedText:"Select options",selectedText:"# selected",selectedList:0,show:null,hide:null,autoOpen:false,multiple:true,position:{}},_create:function(){var b=this.element.hide(),c=this.options;this.speed=a.fx.speeds._default;this._isOpen=false;var d=(this.button=a('<button type="button"><span class="ui-icon ui-icon-triangle-2-n-s"></span></button>')).addClass("ui-multiselect ui-widget ui-state-default ui-corner-all").addClass(c.classes).attr({title:b.attr("title"),"aria-haspopup":true,tabIndex:b.attr("tabIndex")}).insertAfter(b),e=(this.buttonlabel=a("<span />")).html(c.noneSelectedText).appendTo(d),f=(this.menu=a("<div />")).addClass("ui-multiselect-menu ui-widget ui-widget-content ui-corner-all").addClass(c.classes).appendTo(document.body),g=(this.header=a("<div />")).addClass("ui-widget-header ui-corner-all ui-multiselect-header ui-helper-clearfix").appendTo(f),h=(this.headerLinkContainer=a("<ul />")).addClass("ui-helper-reset").html(function(){if(c.header===true){return'<li><a class="ui-multiselect-all" href="#"><span class="ui-icon ui-icon-check"></span><span>'+c.checkAllText+'</span></a></li><li><a class="ui-multiselect-none" href="#"><span class="ui-icon ui-icon-closethick"></span><span>'+c.uncheckAllText+"</span></a></li>"}else if(typeof c.header==="string"){return"<li>"+c.header+"</li>"}else{return""}}).append('<li class="ui-multiselect-close"><a href="#" class="ui-multiselect-close"><span class="ui-icon ui-icon-circle-close"></span></a></li>').appendTo(g),i=(this.checkboxContainer=a("<ul />")).addClass("ui-multiselect-checkboxes ui-helper-reset").appendTo(f);this._bindEvents();this.refresh(true);if(!c.multiple){f.addClass("ui-multiselect-single")}},_init:function(){if(this.options.header===false){this.header.hide()}if(!this.options.multiple){this.headerLinkContainer.find(".ui-multiselect-all, .ui-multiselect-none").hide()}if(this.options.autoOpen){this.open()}if(this.element.is(":disabled")){this.disable()}},refresh:function(b){var d=this.element,e=this.options,f=this.menu,g=this.checkboxContainer,h=[],i="",j=d.attr("id")||c++;d.find("option").each(function(b){var c=a(this),d=this.parentNode,f=this.innerHTML,g=this.title,k=this.value,l="ui-multiselect-"+(this.id||j+"-option-"+b),m=this.disabled,n=this.selected,p=["ui-corner-all"],q=(m?"ui-multiselect-disabled ":" ")+this.className,r;if(d.tagName==="OPTGROUP"){r=d.getAttribute("label");if(a.inArray(r,h)===-1){i+='<li class="ui-multiselect-optgroup-label '+d.className+'"><a href="#">'+r+"</a></li>";h.push(r)}}if(m){p.push("ui-state-disabled")}if(n&&!e.multiple){p.push("ui-state-active")}i+='<li class="'+q+'">';i+='<label for="'+l+'" title="'+g+'" class="'+p.join(" ")+'">';i+='<input id="'+l+'" name="multiselect_'+j+'" type="'+(e.multiple?"checkbox":"radio")+'" value="'+k+'" title="'+f+'"';if(n){i+=' checked="checked"';i+=' aria-selected="true"'}if(m){i+=' disabled="disabled"';i+=' aria-disabled="true"'}i+=" /><span>"+f+"</span></label></li>"});g.html(i);this.labels=f.find("label");this.inputs=this.labels.children("input");this._setButtonWidth();this._setMenuWidth();this.button[0].defaultValue=this.update();if(!b){this._trigger("refresh")}},update:function(){var b=this.options,c=this.inputs,d=c.filter(":checked"),e=d.length,f;if(e===0){f=b.noneSelectedText}else{if(a.isFunction(b.selectedText)){f=b.selectedText.call(this,e,c.length,d.get())}else if(/\d/.test(b.selectedList)&&b.selectedList>0&&e<=b.selectedList){f=d.map(function(){return a(this).next().html()}).get().join(", ")}else{f=b.selectedText.replace("#",e).replace("#",c.length)}}this.buttonlabel.html(f);return f},_bindEvents:function(){function d(){b[b._isOpen?"close":"open"]();return false}var b=this,c=this.button;c.find("span").bind("click.multiselect",d);c.bind({click:d,keypress:function(a){switch(a.which){case 27:case 38:case 37:b.close();break;case 39:case 40:b.open();break}},mouseenter:function(){if(!c.hasClass("ui-state-disabled")){a(this).addClass("ui-state-hover")}},mouseleave:function(){a(this).removeClass("ui-state-hover")},focus:function(){if(!c.hasClass("ui-state-disabled")){a(this).addClass("ui-state-focus")}},blur:function(){a(this).removeClass("ui-state-focus")}});this.header.delegate("a","click.multiselect",function(c){if(a(this).hasClass("ui-multiselect-close")){b.close()}else{b[a(this).hasClass("ui-multiselect-all")?"checkAll":"uncheckAll"]()}c.preventDefault()});this.menu.delegate("li.ui-multiselect-optgroup-label a","click.multiselect",function(c){c.preventDefault();var d=a(this),e=d.parent().nextUntil("li.ui-multiselect-optgroup-label").find("input:visible:not(:disabled)"),f=e.get(),g=d.parent().text();if(b._trigger("beforeoptgrouptoggle",c,{inputs:f,label:g})===false){return}b._toggleChecked(e.filter(":checked").length!==e.length,e);b._trigger("optgrouptoggle",c,{inputs:f,label:g,checked:f[0].checked})}).delegate("label","mouseenter.multiselect",function(){if(!a(this).hasClass("ui-state-disabled")){b.labels.removeClass("ui-state-hover");a(this).addClass("ui-state-hover").find("input").focus()}}).delegate("label","keydown.multiselect",function(c){c.preventDefault();switch(c.which){case 9:case 27:b.close();break;case 38:case 40:case 37:case 39:b._traverse(c.which,this);break;case 13:a(this).find("input")[0].click();break}}).delegate('input[type="checkbox"], input[type="radio"]',"click.multiselect",function(c){var d=a(this),e=this.value,f=this.checked,g=b.element.find("option");if(this.disabled||b._trigger("click",c,{value:e,text:this.title,checked:f})===false){c.preventDefault();return}d.focus();d.attr("aria-selected",f);g.each(function(){if(this.value===e){this.selected=f}else if(!b.options.multiple){this.selected=false}});if(!b.options.multiple){b.labels.removeClass("ui-state-active");d.closest("label").toggleClass("ui-state-active",f);b.close()}b.element.trigger("change");setTimeout(a.proxy(b.update,b),10)});a(document).bind("mousedown.multiselect",function(c){if(b._isOpen&&!a.contains(b.menu[0],c.target)&&!a.contains(b.button[0],c.target)&&c.target!==b.button[0]){b.close()}});a(this.element[0].form).bind("reset.multiselect",function(){setTimeout(a.proxy(b.refresh,b),10)})},_setButtonWidth:function(){var a=this.element.outerWidth(),b=this.options;if(/\d/.test(b.minWidth)&&a<b.minWidth){a=b.minWidth}this.button.width(a)},_setMenuWidth:function(){var a=this.menu,b=this.button.outerWidth()-parseInt(a.css("padding-left"),10)-parseInt(a.css("padding-right"),10)-parseInt(a.css("border-right-width"),10)-parseInt(a.css("border-left-width"),10);a.width(b||this.button.outerWidth())},_traverse:function(b,c){var d=a(c),e=b===38||b===37,f=d.parent()[e?"prevAll":"nextAll"]("li:not(.ui-multiselect-disabled, .ui-multiselect-optgroup-label)")[e?"last":"first"]();if(!f.length){var g=this.menu.find("ul").last();this.menu.find("label")[e?"last":"first"]().trigger("mouseover");g.scrollTop(e?g.height():0)}else{f.find("label").trigger("mouseover")}},_toggleState:function(a,b){return function(){if(!this.disabled){this[a]=b}if(b){this.setAttribute("aria-selected",true)}else{this.removeAttribute("aria-selected")}}},_toggleChecked:function(b,c){var d=c&&c.length?c:this.inputs,e=this;d.each(this._toggleState("checked",b));d.eq(0).focus();this.update();var f=d.map(function(){return this.value}).get();this.element.find("option").each(function(){if(!this.disabled&&a.inArray(this.value,f)>-1){e._toggleState("selected",b).call(this)}});if(d.length){this.element.trigger("change")}},_toggleDisabled:function(b){this.button.attr({disabled:b,"aria-disabled":b})[b?"addClass":"removeClass"]("ui-state-disabled");var c=this.menu.find("input");var d="ech-multiselect-disabled";if(b){c=c.filter(":enabled").data(d,true)}else{c=c.filter(function(){return a.data(this,d)===true}).removeData(d)}c.attr({disabled:b,"arial-disabled":b}).parent()[b?"addClass":"removeClass"]("ui-state-disabled");this.element.attr({disabled:b,"aria-disabled":b})},open:function(b){var c=this,d=this.button,e=this.menu,f=this.speed,g=this.options,h=[];var i=d.height()+parseFloat(d.css("margin-top"))+parseFloat(d.css("margin-bottom"))+parseFloat(d.css("padding-top"))+parseFloat(d.css("padding-bottom")+parseFloat(d.css("border-top-width"))+parseFloat(d.css("border-bottom-width")));if(this._trigger("beforeopen")===false||d.hasClass("ui-state-disabled")||this._isOpen){return}var j=e.find("ul").last(),k=g.show,l=d.offset();if(a.isArray(g.show)){k=g.show[0];f=g.show[1]||c.speed}if(k){h=[k,f]}j.scrollTop(0).height(g.height);if(a.ui.position&&!a.isEmptyObject(g.position)){g.position.of=g.position.of||d;e.show().position(g.position).hide()}else{e.css({top:l.top+i,left:l.left})}a.fn.show.apply(e,h);this.labels.eq(0).trigger("mouseover").trigger("mouseenter").find("input").trigger("focus");d.addClass("ui-state-active");this._isOpen=true;this._trigger("open")},close:function(){if(this._trigger("beforeclose")===false){return}var b=this.options,c=b.hide,d=this.speed,e=[];if(a.isArray(b.hide)){c=b.hide[0];d=b.hide[1]||this.speed}if(c){e=[c,d]}a.fn.hide.apply(this.menu,e);this.button.removeClass("ui-state-active").trigger("blur").trigger("mouseleave");this._isOpen=false;this._trigger("close")},enable:function(){this._toggleDisabled(false)},disable:function(){this._toggleDisabled(true)},checkAll:function(a){this._toggleChecked(true);this._trigger("checkAll")},uncheckAll:function(){this._toggleChecked(false);this._trigger("uncheckAll")},getChecked:function(){return this.menu.find("input").filter(":checked")},destroy:function(){a.Widget.prototype.destroy.call(this);this.button.remove();this.menu.remove();this.element.show();return this},isOpen:function(){return this._isOpen},widget:function(){return this.menu},getButton:function(){return this.button},_setOption:function(b,c){var d=this.menu;switch(b){case"header":d.find("div.ui-multiselect-header")[c?"show":"hide"]();break;case"checkAllText":d.find("a.ui-multiselect-all span").eq(-1).text(c);break;case"uncheckAllText":d.find("a.ui-multiselect-none span").eq(-1).text(c);break;case"height":d.find("ul").last().height(parseInt(c,10));break;case"minWidth":this.options[b]=parseInt(c,10);this._setButtonWidth();this._setMenuWidth();break;case"selectedText":case"selectedList":case"noneSelectedText":this.options[b]=c;this.update();break;case"classes":d.add(this.button).removeClass(this.options.classes).addClass(c);break;case"multiple":d.toggleClass("ui-multiselect-single",!c);this.options.multiple=c;this.element[0].multiple=c;this.refresh()}a.Widget.prototype._setOption.apply(this,arguments)}})})(jQuery)
