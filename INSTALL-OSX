#These instructions are for OSX 10.7 (Lion) and above

#Install RVM with Ruby and Rails: https://rvm.io/rvm/install
    \curl -L https://get.rvm.io | bash -s stable --rails

#Resource your bash profile
source ~/.bash_profile

#Install git if it is not installed already.
    # if you do not have homebrew here is a fast way to get it: (http://mxcl.github.com/homebrew/)
    ruby -e "$(curl -fsSkL raw.github.com/mxcl/homebrew/go)"
    brew install git

#Install PostgreSQL from: http://postgresapp.com
#Once installed, be sure to launch PostgreSQL before attempting to fire up the rails application below

# check out the code
git clone git://github.com/genome/dgi-db.git
cd dgi-db

#This seems to give a read-only version of the repo.  To fix this you can do something like this:
git remote rename origin origin-ro
git remote add origin git@github.com:genome/dgi-db.git
git fetch origin
git pull origin master
git push origin master
git remote remove origin-ro

#install gem dependencies
bundle install

#If you get an error related to 'time zone utc' try rebooting...
#On OSX Mountain Lion you may have to do this: 'sudo ln -s /usr/bin/gcc /usr/bin/gcc-4.2' to get bundle install to succeed

#bootstrap the local database
rake dgidb:load_local

#Occassionally the database may get into a confused state and this rake command no longer works properly
#In that case you can try this:
psql -h localhost -d dgidb -f db/structure.sql
psql -h localhost -d dgidb -f db/data.sql

#launch your development server
rails s

#View the app in your browser by going to the following url
http://localhost:3000/

#If the database has been updated to include new sources you may need to clear the dgidb cache by loading the following URL:
http://localhost:3000/cache/invalidate/

